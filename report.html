<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´ç¡çœ åˆ†ææŠ¥å‘Š - Easezy</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <span class="logo-icon">ğŸ¨</span>
                <span class="logo-text">easezy</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">é¦–é¡µ</a></li>
                <li><a href="content.html">ç¡çœ çŸ¥è¯†</a></li>
                <li><a href="membership.html">ä¼šå‘˜</a></li>
                <li><a href="about.html">å…³äºæˆ‘ä»¬</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <section class="full-report-section">
            <div class="container-wide">
                <div class="report-title-area">
                    <h1 id="reportMainTitle">æ­£åœ¨åŠ è½½æŠ¥å‘Š...</h1>
                </div>

                <!-- Tabså¯¼èˆª -->
                <div class="report-tabs">
                    <button class="report-tab active" data-section="section1">ä½ çœŸæ­£çš„æ ·å­</button>
                    <button class="report-tab" data-section="section2">å¤§è„‘æœºåˆ¶</button>
                    <button class="report-tab" data-section="section3">éšè—ç»†èŠ‚</button>
                    <button class="report-tab" data-section="section4">ç±»å‹å¯¹æ¯”</button>
                    <button class="report-tab" data-section="section5">åç›´è§‰çœŸç›¸</button>
                    <button class="report-tab" data-section="section6">æ”¹å˜æ–¹å‘</button>
                    <button class="report-tab" data-section="section7">å†™ç»™ä½ </button>
                </div>

                <!-- æŠ¥å‘Šå†…å®¹åŒº -->
                <div class="report-main-content">
                    <div id="reportFullContent">
                        <p>æ­£åœ¨ä¸ºä½ ç”Ÿæˆä¸ªæ€§åŒ–æŠ¥å‘Š...</p>
                    </div>

                    <!-- ä¸‹ä¸€é¡µæŒ‰é’® -->
                    <div class="report-navigation">
                        <button class="btn-secondary" id="prevSection" style="display: none;">ä¸Šä¸€ç« </button>
                        <button class="btn-primary" id="nextSection">ä¸‹ä¸€ç« </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Easezy. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/track.js"></script>
    <script src="js/report.js"></script>
    <script>
        // åœ¨åŠ è½½æŠ¥å‘Šå‰æ£€æŸ¥è´­ä¹°çŠ¶æ€
        (async function checkAccess() {
            const userToken = localStorage.getItem('userToken');
            const isPurchased = localStorage.getItem('isPurchased');

            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (!userToken) {
                alert('è¯·å…ˆç™»å½•è´¦å·');
                sessionStorage.setItem('loginRedirect', 'report.html');
                window.location.href = 'login.html';
                return;
            }

            // å…ˆæ£€æŸ¥æœ¬åœ°çŠ¶æ€
            if (isPurchased !== 'true') {
                // æœ¬åœ°æ˜¾ç¤ºæœªè´­ä¹°ï¼Œè·³è½¬åˆ°è§£é”é¡µé¢
                alert('è¯·å…ˆè§£é”æŠ¥å‘Š');
                window.location.href = 'unlock-report.html';
                return;
            }

            // éªŒè¯æœåŠ¡å™¨ç«¯è´­ä¹°çŠ¶æ€ï¼ˆå¯é€‰ï¼Œå¢å¼ºå®‰å…¨æ€§ï¼‰
            try {
                const response = await fetch('/api/purchase?action=check', {
                    headers: {
                        'Authorization': 'Bearer ' + userToken
                    }
                });

                const data = await response.json();

                if (!response.ok || !data.isPurchased) {
                    // æœåŠ¡å™¨éªŒè¯å¤±è´¥ï¼Œæ¸…é™¤æœ¬åœ°çŠ¶æ€
                    localStorage.setItem('isPurchased', 'false');
                    alert('è´­ä¹°çŠ¶æ€å¼‚å¸¸ï¼Œè¯·é‡æ–°è§£é”');
                    window.location.href = 'unlock-report.html';
                    return;
                }

                // éªŒè¯é€šè¿‡ï¼Œæ­£å¸¸æ˜¾ç¤ºæŠ¥å‘Š
            } catch (error) {
                console.error('Check purchase error:', error);
                // ç½‘ç»œé”™è¯¯æ—¶ï¼Œæš‚æ—¶å…è®¸è®¿é—®ï¼ˆåŸºäºæœ¬åœ°çŠ¶æ€ï¼‰
                console.warn('æ— æ³•éªŒè¯è´­ä¹°çŠ¶æ€ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜');
            }
        })();
    </script>
</body>
</html>
