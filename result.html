<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯„ä¼°ç»“æœ - Easezy</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="ç§‘å­¦çš„ç¡çœ è¯„ä¼°ã€ä¸ªæ€§åŒ–æ”¹å–„æ–¹æ¡ˆã€èˆ’çœ å£°æ™¯éŸ³ä¹å’Œç¡çœ æ—¥è®°">
    <meta name="theme-color" content="#7FA59A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Easezy">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/images/logo.png">

    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">
                <span class="logo-icon"><img src="images/logo.png" alt="Easezy Logo"></span>
                <span class="logo-text">easezy</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">é¦–é¡µ</a></li>
                <li><a href="content.html">ç¡çœ çŸ¥è¯†</a></li>
                <li><a href="about.html">å…³äºæˆ‘ä»¬</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <section class="result-section">
            <div class="container">
                <div class="result-header">
                    <h1>ä½ çš„ç¡çœ è¯„ä¼°ç»“æœ</h1>
                </div>

                <div class="result-card">
                    <div class="sleep-type">
                        <h2 id="sleepType">æ­£åœ¨åˆ†æ...</h2>
                        <div class="type-badge" id="typeBadge"></div>
                    </div>

                    <div class="result-description" id="resultDescription">
                        <p>æ­£åœ¨ä¸ºä½ åˆ†æç¡çœ æ¨¡å¼...</p>
                    </div>

                    <div class="next-step">
                        <div class="cta-box">
                            <button id="buyReportBtn" class="btn-primary large" onclick="handleBuyReport()">è·å–å®Œæ•´åˆ†ææŠ¥å‘Š Â¥9.9</button>
                        </div>

                        <div class="alternative-actions">
                            <a href="content.html" class="link-secondary">å…ˆäº†è§£ä¸€äº›ç¡çœ çŸ¥è¯†</a>
                            <a href="assessment.html" class="link-secondary">é‡æ–°è¯„ä¼°</a>
                        </div>

                        <!-- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º -->
                        <div id="userInfo" style="margin-top: 20px; text-align: center; color: var(--secondary-text); font-size: 14px; display: none;">
                            <p>å½“å‰ç™»å½•ï¼š<span id="userEmail"></span> | <a href="#" onclick="logout()" style="color: var(--primary-color);">é€€å‡º</a></p>
                        </div>
                    </div>

                    <!-- æ”¯ä»˜ä¿¡æ¯å¼¹çª— -->
                    <div id="paymentInfoModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                         background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
                        <div style="background: white; padding: 40px; border-radius: 12px; max-width: 600px; text-align: center;
                                    max-height: 90vh; overflow-y: auto;">
                            <h2 style="margin-bottom: 20px; color: var(--text-color);">è·å–å®Œæ•´æŠ¥å‘Š</h2>

                            <div style="background: #FFF9E6; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: left;">
                                <h3 style="margin-top: 0; color: var(--text-color); font-size: 16px;">ğŸ“ è´­ä¹°æµç¨‹ï¼š</h3>
                                <ol style="margin: 10px 0; padding-left: 20px; color: var(--text-color); line-height: 1.8;">
                                    <li>æ‰«æä¸‹æ–¹æ”¶æ¬¾ç æ”¯ä»˜ Â¥9.9</li>
                                    <li>æ·»åŠ å¾®ä¿¡ï¼ˆè§ä¸‹æ–¹äºŒç»´ç ï¼‰</li>
                                    <li>å‘é€ä»˜æ¬¾æˆªå›¾</li>
                                    <li>è·å–è®¿é—®å¯†ç </li>
                                    <li>è¾“å…¥å¯†ç æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š</li>
                                </ol>
                            </div>

                            <div style="display: flex; gap: 30px; justify-content: center; margin: 30px 0; flex-wrap: wrap;">
                                <!-- æ”¶æ¬¾ç  -->
                                <div>
                                    <h3 style="color: var(--text-color); font-size: 14px; margin-bottom: 10px;">â‘  æ‰«ç æ”¯ä»˜ Â¥9.9</h3>
                                    <div style="width: 200px; height: 200px; border: 2px solid #E0DED9; border-radius: 8px;
                                                display: flex; align-items: center; justify-content: center; background: #F9F9F9;">
                                        <img id="paymentQRCode" src="" alt="æ”¶æ¬¾ç " style="max-width: 100%; max-height: 100%;">
                                        <p style="color: #999; font-size: 12px; margin: 0;" id="qrcodePlaceholder">è¯·åœ¨ä¸‹æ–¹è®¾ç½®æ”¶æ¬¾ç </p>
                                    </div>
                                </div>

                                <!-- å¾®ä¿¡äºŒç»´ç  -->
                                <div>
                                    <h3 style="color: var(--text-color); font-size: 14px; margin-bottom: 10px;">â‘¡ æ·»åŠ å¾®ä¿¡è·å–å¯†ç </h3>
                                    <div style="width: 200px; height: 200px; border: 2px solid #E0DED9; border-radius: 8px;
                                                display: flex; align-items: center; justify-content: center; background: #F9F9F9;">
                                        <img id="wechatQRCode" src="" alt="å¾®ä¿¡äºŒç»´ç " style="max-width: 100%; max-height: 100%;">
                                        <p style="color: #999; font-size: 12px; margin: 0;" id="wechatPlaceholder">è¯·åœ¨ä¸‹æ–¹è®¾ç½®å¾®ä¿¡äºŒç»´ç </p>
                                    </div>
                                    <p id="wechatIdText" style="color: var(--secondary-text); font-size: 12px; margin-top: 8px;"></p>
                                </div>
                            </div>

                            <div style="background: #FFF0F0; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: left;">
                                <p style="margin: 0; color: #D32F2F; font-size: 13px;">
                                    âš ï¸ æ³¨æ„ï¼šä»˜æ¬¾åè¯·åŠ¡å¿…æ·»åŠ å¾®ä¿¡å¹¶å‘é€ä»˜æ¬¾æˆªå›¾ï¼Œå¦åˆ™æ— æ³•è·å–è®¿é—®å¯†ç 
                                </p>
                            </div>

                            <div style="margin-top: 20px;">
                                <button onclick="closePaymentModal()" style="padding: 10px 30px; background: var(--primary-color);
                                        color: white; border: none; border-radius: 6px; cursor: pointer; margin-right: 10px;">
                                    æˆ‘å·²æ·»åŠ å¾®ä¿¡
                                </button>
                                <button onclick="goToPasswordPage()" style="padding: 10px 30px; background: white;
                                        color: var(--primary-color); border: 1px solid var(--primary-color); border-radius: 6px; cursor: pointer;">
                                    å·²æœ‰å¯†ç ï¼Œç«‹å³è¾“å…¥
                                </button>
                            </div>

                            <p style="margin-top: 15px;">
                                <a href="javascript:void(0)" onclick="closePaymentModal()"
                                   style="color: var(--secondary-text); font-size: 14px; text-decoration: none;">
                                    å–æ¶ˆ
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Easezy. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/track.js"></script>
    <script src="js/result.js"></script>
    <script>
        // ========== åœ¨è¿™é‡Œè®¾ç½®ä½ çš„æ”¶æ¬¾ç å’Œå¾®ä¿¡äºŒç»´ç  ==========
        const PAYMENT_QRCODE = 'images/payment-qrcode.png';  // ä½ çš„æ”¶æ¬¾ç å›¾ç‰‡è·¯å¾„ï¼ˆæ”¯æŒjpg/jpeg/pngï¼‰
        const WECHAT_QRCODE = 'images/wechat-qrcode.png';    // ä½ çš„å¾®ä¿¡äºŒç»´ç å›¾ç‰‡è·¯å¾„ï¼ˆæ”¯æŒjpg/jpeg/pngï¼‰
        const WECHAT_ID = 'your_wechat_id';                   // ä½ çš„å¾®ä¿¡å·ï¼ˆå¯é€‰ï¼‰

        // æ˜¾ç¤ºæ”¯ä»˜ä¿¡æ¯å¼¹çª—
        function showPaymentInfo() {
            const modal = document.getElementById('paymentInfoModal');
            modal.style.display = 'flex';

            // è®¾ç½®æ”¶æ¬¾ç 
            const paymentQR = document.getElementById('paymentQRCode');
            const qrPlaceholder = document.getElementById('qrcodePlaceholder');
            if (PAYMENT_QRCODE && !PAYMENT_QRCODE.includes('payment-qrcode.')) {
                // ç”¨æˆ·å·²è®¾ç½®è‡ªå·±çš„å›¾ç‰‡è·¯å¾„
                paymentQR.src = PAYMENT_QRCODE;
                paymentQR.style.display = 'block';
                qrPlaceholder.style.display = 'none';
            } else if (PAYMENT_QRCODE.endsWith('.png') || PAYMENT_QRCODE.endsWith('.jpg') || PAYMENT_QRCODE.endsWith('.jpeg')) {
                // æ£€æŸ¥é»˜è®¤æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                paymentQR.src = PAYMENT_QRCODE;
                paymentQR.onerror = function() {
                    paymentQR.style.display = 'none';
                    qrPlaceholder.style.display = 'block';
                    qrPlaceholder.innerHTML = 'è¯·å°†æ”¶æ¬¾ç å›¾ç‰‡<br>æ”¾åˆ°imagesæ–‡ä»¶å¤¹<br>æ”¯æŒjpg/pngæ ¼å¼';
                };
                paymentQR.style.display = 'block';
                qrPlaceholder.style.display = 'none';
            } else {
                paymentQR.style.display = 'none';
                qrPlaceholder.style.display = 'block';
                qrPlaceholder.innerHTML = 'è¯·åœ¨result.htmlä¸­<br>è®¾ç½®PAYMENT_QRCODE';
            }

            // è®¾ç½®å¾®ä¿¡äºŒç»´ç 
            const wechatQR = document.getElementById('wechatQRCode');
            const wechatPlaceholder = document.getElementById('wechatPlaceholder');
            if (WECHAT_QRCODE && !WECHAT_QRCODE.includes('wechat-qrcode.')) {
                // ç”¨æˆ·å·²è®¾ç½®è‡ªå·±çš„å›¾ç‰‡è·¯å¾„
                wechatQR.src = WECHAT_QRCODE;
                wechatQR.style.display = 'block';
                wechatPlaceholder.style.display = 'none';
            } else if (WECHAT_QRCODE.endsWith('.png') || WECHAT_QRCODE.endsWith('.jpg') || WECHAT_QRCODE.endsWith('.jpeg')) {
                // æ£€æŸ¥é»˜è®¤æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                wechatQR.src = WECHAT_QRCODE;
                wechatQR.onerror = function() {
                    wechatQR.style.display = 'none';
                    wechatPlaceholder.style.display = 'block';
                    wechatPlaceholder.innerHTML = 'è¯·å°†å¾®ä¿¡äºŒç»´ç <br>æ”¾åˆ°imagesæ–‡ä»¶å¤¹<br>æ”¯æŒjpg/pngæ ¼å¼';
                };
                wechatQR.style.display = 'block';
                wechatPlaceholder.style.display = 'none';
            } else {
                wechatQR.style.display = 'none';
                wechatPlaceholder.style.display = 'block';
                wechatPlaceholder.innerHTML = 'è¯·åœ¨result.htmlä¸­<br>è®¾ç½®WECHAT_QRCODE';
            }

            // è®¾ç½®å¾®ä¿¡å·æ–‡æœ¬
            const wechatText = document.getElementById('wechatIdText');
            if (WECHAT_ID && WECHAT_ID !== 'your_wechat_id') {
                wechatText.textContent = 'å¾®ä¿¡å·: ' + WECHAT_ID;
            } else {
                wechatText.textContent = '';
            }
        }

        // å…³é—­å¼¹çª—
        function closePaymentModal() {
            const modal = document.getElementById('paymentInfoModal');
            modal.style.display = 'none';
        }

        // è·³è½¬åˆ°å¯†ç è¾“å…¥é¡µ
        function goToPasswordPage() {
            window.location.href = 'unlock-report.html';
        }

        // å¤„ç†è´­ä¹°æŠ¥å‘ŠæŒ‰é’®ç‚¹å‡»
        function handleBuyReport() {
            // æ£€æŸ¥æ˜¯å¦ç™»å½•
            const userEmail = localStorage.getItem('userEmail');
            const userToken = localStorage.getItem('userToken');

            if (!userEmail || !userToken) {
                // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
                if (confirm('è´­ä¹°æŠ¥å‘Šéœ€è¦å…ˆç™»å½•è´¦å·ï¼Œæ˜¯å¦å‰å¾€ç™»å½•ï¼Ÿ')) {
                    sessionStorage.setItem('loginRedirect', 'result.html');
                    window.location.href = 'login.html';
                }
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²è´­ä¹°
            const isPurchased = localStorage.getItem('isPurchased');
            if (isPurchased === 'true') {
                // å·²è´­ä¹°ï¼Œç›´æ¥è·³è½¬åˆ°æŠ¥å‘Š
                if (confirm('æ‚¨å·²ç»è´­ä¹°è¿‡æŠ¥å‘Šï¼Œæ˜¯å¦ç›´æ¥æŸ¥çœ‹ï¼Ÿ')) {
                    window.location.href = 'report.html';
                }
                return;
            }

            // æ˜¾ç¤ºæ”¯ä»˜ä¿¡æ¯
            showPaymentInfo();
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('userEmail');
                localStorage.removeItem('userToken');
                localStorage.removeItem('isPurchased');
                location.reload();
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.addEventListener('DOMContentLoaded', () => {
            const userEmail = localStorage.getItem('userEmail');
            const userToken = localStorage.getItem('userToken');
            const isPurchased = localStorage.getItem('isPurchased');

            if (userEmail && userToken) {
                // å·²ç™»å½•ï¼Œæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                document.getElementById('userInfo').style.display = 'block';
                document.getElementById('userEmail').textContent = userEmail;

                // å¦‚æœå·²è´­ä¹°ï¼Œä¿®æ”¹æŒ‰é’®æ–‡å­—
                if (isPurchased === 'true') {
                    document.getElementById('buyReportBtn').textContent = 'æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š';
                }
            }
        });
    </script>
    <script src="js/pwa.js"></script>
</body>
</html>
